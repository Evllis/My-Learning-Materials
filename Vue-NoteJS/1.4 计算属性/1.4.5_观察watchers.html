<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script src="../vue.js" type="text/javascript"></script>
	<script src="../jquery-3.1.1.min.js"></script>
	<style>
		body, dl {
			margin: 0;
			padding: 0;
		}
		.get-btn {
			color: white;
			border: 1px solid black;
			background-color: red;
			display: inline-block;
			padding: 0 15px;
			line-height: 24px;
			cursor: pointer;
		}
		.message .toRed {
			color: red;
		}
		.message .toGreen {
			color: green;
		}
		.main-cont {
			width: 1200px;
			margin: 0 auto;
		}
		.item-move {
			margin-top: 10px;
			border: 4px solid #ccc;
		}
	</style>
	<title>1.4.5_观察watchers</title>
</head>
<body>
	<div id="box">
		<div class="main-cont">
			<dl class="item-move" v-for="(items, index) in contentList">
				<dt>
					<a :href="items.alt">
						<img :src="items.images.medium" />
					</a>
				</dt>
				<dd>
					<div class="title">
						<span>{{ items.title }}</span>
						<span>{{ items.original_title }}</span>
					</div>
					<div class="director">
						<a v-for="director in items.directors" :href="director.alt">
							{{ director.name }}
						</a>
					</div>
					<div class="casts">
						<a v-for="cast in items.casts" :href="cast.alt">
							{{ cast.name }}
						</a>
					</div>
					<div class="genres">
						<span v-for="genre in items.genres">
							{{ genre }}
						</span>
					</div>
					<div class="year">{{ items.year }}</div>
					<div class="other-info">
						<span><mark>{{items.collect_count}}</mark>人看过</span>
					</div>
					<span class="average">{{ items.rating.average }}</span>
				</dd>
			</dl>
		</div>
		<p class="message">
			当前状态:
			<span v-if="showInit">未操作</span>
			<span v-if="showMe" :class=" fontColor ? 'toRed' : 'toGreen' ">{{ logMsg }}</span>
		</p>
		<p>当前信息为{{ num }}条</p>
		<a :data-isclick="isClick" @click="getInfo" href="javascript:;" class="get-btn">获取</a>
	</div>
	<script>
		var timer = null;
		var vm = new Vue({
			el: '#box',
			data: {
				num: 0,
				isClick: false,
				showMe: false,
				showInit: true,
				logMsg: '未操作',
				fontColor: true,
				contentList: []
			},
			watch: {
				isClick: function(value) {
					this.getDetails();
				},
				content: function(value) {
					this.appendCont();
				}
			},
			methods: {
				getInfo: function() {
					this.showInit = false;
					this.isClick = true;
					this.showMe = true;
					this.fontColor = true;
					this.logMsg = '正在获取中, 请稍等......';
				},
				getDetails: function() {
					this.isClick = false;
					var _that = this;
					clearTimeout(timer);
					timer = setTimeout(function() {
						var _url = 'https://api.douban.com/v2/movie/top250';
						$.ajax({
							type: 'GET',
							url: _url,
							dataType: 'jsonp',
							jsonp: 'callback',
							success: function(data) {
								_that.contentList = data.subjects;
							}
						});
						_that.fontColor = false;
						_that.logMsg = '获取成功!';
					}, 500);
				}
			}
		});

	</script>
</body>
</html>